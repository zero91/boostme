<!--{template header}-->
<style type="text/css">
.input_ok {background: url("{SITE_URL}/css/default/input_ok.png") no-repeat scroll 6px 5px transparent;line-height: 30px;padding: 7px 6px 5px 28px;}
.input_error {background: url("{SITE_URL}/css/default/input_error.png") no-repeat scroll 6px 7px;font-size: 13px;color:red;line-height:30px;padding:6px 6px 7px 28px;}
</style>
<script type="text/javascript">
    $(function(){
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
          if (e.target.id == "profile") {
            location.href = "{url user/profile}";
          } else if (e.target.id == "password") {
            location.href = "{url user/uppass}";
          } else if (e.target.id == "modavatar") {
            location.href = "{url user/editimg}";
          }
        });
        $("#menu_resume").addClass("active");
    })
</script>
<div class="container" style="margin-top:5px;">
  <div class="col-md-3"><!--{template leftmenu}--></div>
  <div class="col-md-9" style="font-size:13px;">
    <h5>个人信息</h5>
    <ul class="nav nav-tabs" role="tablist" id="myTab">
      <li><a href="#profile" id="profile" role="tab" data-toggle="tab">基本信息</a></li>
      <li><a href="#password" id="password" role="tab" data-toggle="tab">修改密码</a></li>
      <li><a href="#modavatar" id="modavatar" role="tab" data-toggle="tab">修改头像</a></li>
      <li class="active"><a href="#resume" id="resume" role="tab" data-toggle="tab">我的简历</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane" id="profile"></div>
      <div class="tab-pane" id="password"></div>
      <div class="tab-pane" id="modavatar"></div>
      <div class="tab-pane active" id="resume">
        <form method="POST" name="upinfoForm" action="{url user/resume}" class="form-horizontal">
          <!--{eval $edu_idx_list = array_slice(range(0, count($edu_list)), 0, -1);}-->
          <!--{loop $edu_idx_list $idx}-->
          <div class="panel panel-default" name="school_box" id="edu_{$idx}">
            <div class="panel-body">
              <div class="form-group" style="margin-bottom:5px;margin-top:15px"></div>
              <div class="form-group">
                <div id="delete_edu" style="position:absolute;right:40px;">
                  <a type="button" name="del_edu_{$idx}" class="glyphicon glyphicon-trash del_edu_btn" id="del_edu_{$idx}" style="color:grey"></a>
                </div>
                <label class="col-sm-2 control-label">学校:</label>
                <div class="col-sm-5">
                  <input type="text" name="school[]" id="school-{$idx}" value="{$edu_list[$idx]['school']}" onclick="pop({$idx})" class="form-control"/>
                  <div id="choose-box-wrapper-{$idx}" class="choose-box-wrapper">
                    <div id="choose-box-{$idx}" class="choose-box">
                      <div id="choose-box-title-{$idx}" class="choose-box-title">
                        <span>选择学校</span>
                      </div>
                      <div id="choose-a-province-{$idx}" class="choose-a-province"></div>
                      <div id="choose-a-school-{$idx}" class="choose-a-school"> </div>
                      <div id="choose-box-bottom-{$idx}" class="choose-box-bottom">
                        <input type="button" onclick="hide($idx)" value="关闭"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">学历:</label>
                <div class="col-sm-5">
                    <select name="edu_type[]" id="edu_type-{$idx}" class="form-control">
                    <option value="">--请选择--</option>
                    <option value="{HIGH_SCHOOL}" <!--{if $edu_list[$idx]['edu_type']==HIGH_SCHOOL}-->selected<!--{/if}--> >高中</option>
                    <option value="{BACHELOR}"    <!--{if $edu_list[$idx]['edu_type']==BACHELOR}-->selected<!--{/if}-->    >本科</option>
                    <option value="{MASTER}"      <!--{if $edu_list[$idx]['edu_type']==MASTER}-->selected<!--{/if}-->      >硕士研究生</option>
                    <option value="{DOCTOR}"      <!--{if $edu_list[$idx]['edu_type']==DOCTOR}-->selected<!--{/if}-->      >博士研究生</option>
                    <option value="{POST_DOCTOR}" <!--{if $edu_list[$idx]['edu_type']==POST_DOCTOR}-->selected<!--{/if}--> >博士后</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">院系:</label>
                <div class="col-sm-5">
                  <input type="text" name="dept[]" id="dept-{$idx}" value="{$edu_list[$idx]['department']}" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">专业:</label>
                <div class="col-sm-5">
                  <input type="text" name="major[]" id="major-{$idx}" value="{$edu_list[$idx]['major']}" class="form-control"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">开始时间:</label>
                <div class="col-sm-5">
                  <input type="text" name="start_time[]" id="datepicker-0-{$idx}" readonly class="form-control datepicker" value="{$edu_list[$idx]['start_time']}"/>
                </div>
              </div>
              <div class="form-group">
                <label class="col-sm-2 control-label">结束时间:</label>
                <div class="col-sm-5">
                  <input type="text" name="end_time[]" id="datepicker-1-{$idx}" readonly class="form-control datepicker" value="{$edu_list[$idx]['end_time']}" />
                </div>
              </div>
            </div>
          </div>
          <!--{/loop}-->
          <span name="submit" id="add_edu_btn" class="btn" onclick="add_edu()"
              style="background:#f9f9f9;border:1px dashed #e8e8e8;margin-left:105px;width: 405px;color:#3c86cf;">
            +&nbsp;&nbsp;增加更多教育经历
          </span>

          <h5>个人主要经历(500字以内):</h5>
          <textarea name="experience" id="experience" class="form-control" maxlength="500"
              style="overflow-y:hidden;padding-bottom:10px;margin-bottom:10px;" onpropertychange="adjust(this);" oninput="adjust(this);">{$resume['experience']}</textarea>

          <div class="panel panel-info">
            <div class="panel-heading" style="font-size:18px;">申请资料</div>
            <div class="panel-body">
              <div style="margin-top:20px;">
                <div class="form-group">
                  <label class="col-sm-3 control-label" for="realname">真实姓名</label>
                  <div class="col-sm-5">
                    <input type="text" class="form-control" id="realname" name="realname" value="{$resume['realname']}"/>
                  </div>
                  <span id="realname_tip"></span>
                </div>

                <div class="form-group">
                  <label class="col-sm-3 control-label" for="ID">身份证</label>
                  <div class="col-sm-5">
                    <input type="text" maxlength="18" class="form-control" name="ID" id="ID" value="{$resume['ID']}" />
                  </div>
                  <span id="ID_tip"></span>
                </div>

                <div class="form-group">
                  <label class="col-sm-3 control-label" for="vcode">持身份证正面照</label>
                  <div class="col-sm-2">
                    <input id="ID_upload" name="ID_upload" type="file" class="btn btn-primary form-control">
                  </div>
                  <div class="col-sm-1" <!--{if empty($resume['ID_path'])}-->style="display:none;"<!--{/if}--> id="ID_path_div">
                    <a data-toggle="modal" id="ID_path_pic" data-target="#IDPathPicModal">
                      <img src="{$resume['ID_path']}" width="40px" height="40px" id="img_id_path_pic">
                    </a>
                  </div>
                  <div class="col-sm-3 btn">.bmp .png .jpg .gif</div>
                  <span id="ID_path_tip"></span>
                </div>

                <div class="form-group">
                  <label class="col-sm-3 control-label" for="vcode">持学生证正面照</label>
                  <div class="col-sm-2">
                    <input id="studentID_upload" name="studentID_upload" type="file" class="btn btn-primary form-control">
                  </div>
                  <div class="col-sm-1" <!--{if empty($resume['studentID'])}-->style="display:none;"<!--{/if}--> id="studentID_div">
                    <a data-toggle="modal" id="studentID_pic" data-target="#studentIDModal">
                      <img src="{$resume['studentID']}" width="40px" height="40px" id="img_studentID">
                    </a>
                  </div>
                  <div class="col-sm-3 btn">.bmp .png .jpg .gif</div>
                  <span id="studentID_tip"></span>
                </div>

                <div class="form-group">
                  <label class="col-sm-3 control-label" for="vcode">电子简历</label>

                  <div class="col-sm-2">
                    <input id="file_upload" name="file_upload" type="file" class="btn btn-primary form-control">
                  </div>
                  <div class="col-sm-2" <!--{if empty($resume['resume_path'])}-->style="display:none;"<!--{/if}--> id="resume_div">
                    <a class="btn btn-link" href="{$resume['resume_path']}" target="_blank" id="resume_link">
                      <!--{if empty($resume['realname'])}-->{$user['username']}<!--{else}-->{$resume['realname']}<!--{/if}-->简历
                    </a>
                  </div>
                  <div class="col-sm-2"><span class="btn">.pdf .doc .docx</span></div>
                  <span id="resume_tip"></span>
                </div>
              </div>

              <div class="form-group" style="margin-bottom:5px;margin-top:15px"></div>
              <div class="form-group"></div>
            </div>
         </div>

          <div>
            <input type="hidden" name="operation" id="operation" value="{RESUME_SAVE}"/>
            <div class="col-sm-3"></div>
            <div class="col-sm-3">
              <button type="submit" name="submit" id="save" class="form-control btn btn-primary" onclick="check_data(this)">保&nbsp;存</button>
            </div>
            <div class="col-sm-3">
              <button type="submit" name="submit" id="request" class="form-control btn btn-primary" onclick="check_data(this)">申请抢单资格</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="IDPathPicModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body" id="ID_path_pic_body">
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span>
          <span class="sr-only">Close</span>
        </button>
        <img src="{$resume['ID_path']}" width="98%" height="98%" id="img_modal_id_path">
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<div class="modal fade" id="studentIDModal" tabindex="-1" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-body" id="studentID_pic_body">
        <button type="button" class="close" data-dismiss="modal">
          <span aria-hidden="true">&times;</span>
          <span class="sr-only">Close</span>
        </button>
        <img src="{$resume['studentID']}" width="98%" height="98%" id="img_modal_studentID">
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<link href="{SITE_URL}js/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{SITE_URL}js/school.js"></script>
<script type="text/javascript" src="{SITE_URL}js/uploadify/jquery.uploadify.js?ver=<?php echo rand(0,9999);?>"></script>
<script type="text/javascript">
var ta = document.getElementById('experience');
ta.style.height=ta.scrollHeight+'px';
g_edu_idx = <!--{eval echo count($edu_list)}-->;

var ID_ok = <!--{eval echo count($resume['ID_path'])}-->;
var studentID_ok = <!--{eval echo count($resume['studentID'])}-->;
var resume_ok = <!--{eval echo count($resume['resume_path'])}-->;

$(document).ready(function() {
     $("body").on('click', '.glyphicon', function() {
         $(this).parent().parent().parent().parent().remove();
     });

    $(".datepicker").datepicker({
        changeYear: true,
        changeMonth: true,
        yearRange: '-60:+5',
        dateFormat: 'yy-mm-dd'
    });

    $('#file_upload').uploadify({
        'swf': '{SITE_URL}js/uploadify/uploadify.swf',
        'uploader': "{url user/upload_resume/$user['uid']}",
        'auto': true,
        'buttonText' : "上传简历",
        'buttonClass' : "btn btn-primary",
        'fileObjName': 'userresume',
        'height': '40px',
        'multi': false,
        'fileSizeLimit': "5MB",
        'fileTypeExts': '*.pdf;*.doc;*.docx',
        'fileTypeDesc': 'User resume(.pdf, .doc, .docx)',
        'onUploadSuccess': function(file, data, response) {
            alert('简历上传成功!'); 
            resume_ok = true;
            $("#resume_link").attr("href", data+"?"+Math.random());
            $("#resume_div").show();
        }
    });

    $('#ID_upload').uploadify({
        'swf': '{SITE_URL}js/uploadify/uploadify.swf',
        'uploader': "{url user/upload_ID/$user['uid']}",
        'auto': true,
        'buttonText' : "上传证件照",
        'buttonClass' : "btn btn-primary",
        'fileObjName': 'userID',
        'height': '40px',
        'multi': false,
        'fileSizeLimit': "7MB",
        'fileTypeExts': '*.bmp;*.png;*.jpg;*.gif',
        'fileTypeDesc': 'User (.bmp, .png, .jpg, .gif)',
        'onUploadSuccess': function(file, data, response) {
            alert('证件照上传成功!');
            ID_ok = true;
            $("#img_id_path_pic").attr("src", data+"?"+Math.random());
            $("#ID_path_div").show();
            $("#img_modal_id_path").attr("src", data+"?"+Math.random());
            $(".uploadify-queue").hide();
        }
    });

    $('#studentID_upload').uploadify({
        'swf': '{SITE_URL}js/uploadify/uploadify.swf',
        'uploader': "{url user/upload_studentID/$user['uid']}",
        'auto': true,
        'buttonText' : "上传学生证",
        'buttonClass' : "btn btn-primary",
        'fileObjName': 'studentID',
        'height': '40px',
        'multi': false,
        'fileSizeLimit': "7MB",
        'fileTypeExts': '*.bmp;*.png;*.jpg;*.gif',
        'fileTypeDesc': 'User (.bmp, .png, .jpg, .gif)',
        'onUploadSuccess': function(file, data, response) {
            alert('学生证上传成功!');
            studentID_ok = true;
            $("#img_studentID").attr("src", data+"?"+Math.random());
            $("#studentID_div").show();
            $("#img_modal_studentID").attr("src", data+"?"+Math.random());
            $(".uploadify-queue").hide();
        }
    });

    $('#submit').click(function() {
        $('#file_upload').uploadify("upload", "*");
        $('#ID_upload').uploadify("upload", "*");
        $('#studentID_upload').uploadify("upload", "*");
    }); 
});

//弹出窗口
function pop(id) {
    //将窗口居中
    makeCenter(id);

    //初始化省份列表
    initProvince(id);

    //默认情况下, 给第一个省份添加choosen样式
    $('[province-id="1"]').addClass('choosen');

    //初始化大学列表
    initSchool(1, id);
}
//隐藏窗口
function hide(id)
{
    $('#choose-box-wrapper-' + id).css("display","none");
}

function initProvince(id)
{
    target_name='#choose-a-province-' + id;
    //原先的省份列表清空
    $(target_name).html('');
    for(i=0;i<schoolList.length;i++)
    {
        $(target_name).append('<a class="province-item" province-id="'+schoolList[i].id+'">'+schoolList[i].name+'</a>');
    }
    //添加省份列表项的click事件
    $('.province-item').bind('click', function(){
            var item=$(this);
            var province = item.attr('province-id');
            var choosenItem = item.parent().find('.choosen');
            if(choosenItem)
                $(choosenItem).removeClass('choosen');
            item.addClass('choosen');
            //更新大学列表
            initSchool(province, id);
        }
    );
}

function initSchool(provinceID, id)
{
    target_name = '#choose-a-school-' + id;
    //原先的学校列表清空
    $(target_name).html('');
    var schools = schoolList[provinceID-1].school;
    for(i=0;i<schools.length;i++)
    {
        $(target_name).append('<a class="school-item" school-id="'+schools[i].id+'">'+schools[i].name+'</a>');
    }
    //添加大学列表项的click事件
    $('.school-item').bind('click', function(){
            var item=$(this);

            var school = item.attr('school-id');
            //更新选择大学文本框中的值

            item.parents(".col-sm-5").children(".form-control").val(item.text());
            //item.parents(".form-group").children(".fohide();
            //item.parents(".input-bar").children(".normal-input").val(item.text());
            //$('#bachelor-school').val(item.text());
            //关闭弹窗
            hide(id);
        }
    );
}

function makeCenter(id)
{
    target_name = '#choose-box-wrapper-' + id;
    $(target_name).css("display","block");
    $(target_name).css("position","absolute");
    $(target_name).css("z-index","1000");
}

function check_data(obj) 
{
    if (obj.id == "save") {
        $("form").unbind('submit');
        $("#operation").val("{RESUME_SAVE}");
        $("form").submit(function() { return true;});
    } else {
        $("form").unbind('submit');
        $("#operation").val("{RESUME_APPLY}");
        $("form").submit(function() {
                if ($("#realname").val().length == 0) {
                    $('#realname_tip').html("请填写您的真实姓名");
                    $('#realname_tip').attr('class', 'input_error');
                    return false;
                } else {
                    $('#realname_tip').html("&nbsp;");
                    $('#realname_tip').attr('class', 'input_ok');
                }

                if ($("#ID").val().length != 18) {
                    $('#ID_tip').html("请填写您的真实身份证号");
                    $('#ID_tip').attr('class', 'input_error');
                    return false;
                } else {
                    $('#ID_tip').html("&nbsp;");
                    $('#ID_tip').attr('class', 'input_ok');
                }

                if (!ID_ok) {
                    $('#ID_path_tip').html("请上传您的身份证照片");
                    $('#ID_path_tip').attr('class', 'input_error');
                    return false;
                } else {
                    $('#ID_path_tip').html("&nbsp;");
                    $('#ID_path_tip').attr('class', 'input_ok');
                }

                if (!studentID_ok) {
                    $('#studentID_tip').html("请上传您的学生证照片");
                    $('#studentID_tip').attr('class', 'input_error');
                    return false;
                } else {
                    $('#studentID_tip').html("&nbsp;");
                    $('#studentID_tip').attr('class', 'input_ok');
                }

                if (!resume_ok) {
                    $('#resume_tip').html("请上传您的电子简历");
                    $('#resume_tip').attr('class', 'input_error');
                    return false;
                } else {
                    $('#resume_tip').html("&nbsp;");
                    $('#resume_tip').attr('class', 'input_ok');
                }
                return true;
            });
    }
}

function add_edu()
{
    if (g_edu_idx >= 6) {
        alert("请认真填写你的教育经历！");
        return false;
    }
    var more_edu = $('<div class="panel panel-default" name="school_box" id="edu_' + g_edu_idx  + '"> <div class="panel-body"> <div class="form-group" style="margin-bottom:5px;margin-top:15px"></div> <div class="form-group"><div id="delete_edu" style="position:absolute;right:40px;"><a type="button" name="del_edu_' + g_edu_idx + '" class="glyphicon glyphicon-trash del_edu_btn" id="del_edu_' + g_edu_idx + '" style="color:grey"></a></div><label class="col-sm-2 control-label">学校:</label> <div class="col-sm-5"> <input type="text" name="school[]" id="school-' + g_edu_idx + '" value="" onclick="pop(' + g_edu_idx + ')" class="form-control"/> <div id="choose-box-wrapper-' + g_edu_idx + '" class="choose-box-wrapper"> <div id="choose-box-' + g_edu_idx + '" class="choose-box"> <div id="choose-box-title-' + g_edu_idx + '" class="choose-box-title"> <span>选择学校</span> </div> <div id="choose-a-province-' + g_edu_idx + '" class="choose-a-province"></div><div id="choose-a-school-' + g_edu_idx + '" class="choose-a-school"> </div> <div id="choose-box-bottom-' + g_edu_idx + '" class="choose-box-bottom"> <input type="button" onclick="hide(' + g_edu_idx + ')" value="关闭"/> </div> </div> </div> </div> </div> <div class="form-group"> <label class="col-sm-2 control-label">学历:</label> <div class="col-sm-5"> <select name="edu_type[]" id="edu_type-' + g_edu_idx + '" class="form-control"><option value="">--请选择--</option><option value="{HIGH_SCHOOL}">高中</option> <option value="{BACHELOR}">本科</option> <option value="{MASTER}">硕士研究生</option> <option value="{DOCTOR}">博士研究生</option> <option value="{POST_DOCTOR}">博士后</option> </select> </div> </div> <div class="form-group"> <label class="col-sm-2 control-label">院系:</label> <div class="col-sm-5"> <input type="text" name="dept[]" id="dept-' + g_edu_idx + '" value="" class="form-control"/> </div> </div> <div class="form-group"> <label class="col-sm-2 control-label">专业:</label> <div class="col-sm-5"> <input type="text" name="major[]" id="major-' + g_edu_idx + '" value="" class="form-control"/> </div> </div> <div class="form-group"> <label class="col-sm-2 control-label">开始时间:</label> <div class="col-sm-5"> <input type="text" name="start_time[]" id="datepicker-0-' + g_edu_idx + '" readonly class="form-control datepicker" /> </div> </div> <div class="form-group"> <label class="col-sm-2 control-label">结束时间:</label> <div class="col-sm-5"> <input type="text" name="end_time[]" id="datepicker-1-' + g_edu_idx + '" readonly class="form-control datepicker"/> </div> </div> </div> </div>');

    more_edu.hide();
    $("#add_edu_btn").before(more_edu);
    g_edu_idx = g_edu_idx + 1;
    more_edu.fadeIn("slow");

    $(".datepicker").datepicker({
        changeYear: true,
        changeMonth: true,
        yearRange: '-60:+5',
        dateFormat: 'yy-mm-dd'
    });
    return false;
}

</script>

<style type="text/css">
.choose-box-wrapper{
    width: 652px;
    background-color:#000;
    filter:alpha(opacity=50);
    background-color: rgba(0, 0, 0, 0.5);
    padding:10px;
    border-radius:5px;
    display:none;
}
.choose-box{
    border: 1px solid #005EAC;
    width:650px;
    background-color:white;
}
.choose-box-title{
    background:#3777BC;
    color: white;
    padding: 4px 10px 5px;
    font-size: 14px;
    font-weight: 700;
    margin: 0;
}
.choose-box-title span{
    font-family: Tahoma, Verdana, STHeiTi, simsun, sans-serif;
}

.choose-a-province, .choose-a-school{
    margin:5px 8px 10px 8px;
    border: 1px solid #C3C3C3;
}
.choose-a-province a{
    display:inline-block;
    height: 18px;
    line-height: 18px;
    color:#005EAC;
    text-decoration: none;
    font-size: 9pt;
    font-family: Tahoma, Verdana, STHeiTi, simsun, sans-serif;
    margin:2px 5px;
    padding: 1px;
    text-align: center;
}
.choose-a-province a:hover{
    text-decoration:underline;
    cursor:pointer;
}
.choose-a-province .choosen{
    background-color: #005EAC;
    color:white;
}

.choose-a-school{
    overflow-x: hidden;
    overflow-y: auto;
    height: 200px;
}
.choose-a-school a{
    height: 18px;
    line-height: 18px;
    color:#005EAC;
    text-decoration: none;
    font-size: 9pt;
    font-family: Tahoma, Verdana, STHeiTi, simsun, sans-serif;
    float: left;
    width: 160px;
    margin: 4px 12px;
    padding-left:10px;
    background:url(2012072500060712.gif) no-repeat 0 9px;
}
.choose-a-school a:hover{
    background-color:#005EAC;
    color:white;
    cursor:pointer;
}

.choose-box-bottom{
    background: #F0F5F8;
    padding: 8px;
    text-align: right;
    border-top: 1px solid #CCC;
    height:40px;
}
.choose-box-bottom input{
    vertical-align: middle;
    text-align: center;
    background-color:#005EAC;
    color:white;
    border-top: 1px solid #B8D4E8;
    border-left: 1px solid #B8D4E8;
    border-right: 1px solid #114680;
    border-bottom: 1px solid #114680;
    cursor: pointer;
    width: 60px;
    height: 25px;
    margin-top: 6px;
    margin-right: 6px;
}
</style>

<!--{template footer}-->
