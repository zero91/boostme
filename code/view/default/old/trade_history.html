<!--{template header}-->

<style type="text/css">
.list-group-item {border:0px;}
.tenpay_btn {background: url("{SITE_URL}public/image/tenpay/cft.gif") left bottom;width:180px; height:71px; border:0px; background-size:cover;}
.alipay_btn {background: url("{SITE_URL}public/image/alipay/alipay.gif") left bottom;width:180px; height:61px; border:0px;background-size:cover;}
</style>

<script type="text/javascript">
$(function() {
    $("#menu_trade_history").addClass("active");

    $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
        if (e.target.id == "jump1") {
            location.href = "{url material/user/sold}";
        } else if (e.target.id == "jump2") {
            location.href = "{url material/user/buy}";
        } else if (e.target.id == "shopping_cart") {
            location.href = "{url trade/buy_now}";
        }
    });
})
</script>

<div class="container" style="margin-top:5px;">
  <div class="col-md-3"><!--{template leftmenu}--></div>
  <div class="col-md-9">
    <h5 style="float:left;">我的资料</h5>
    <div class="clearfix"></div> 

    <ul class="nav nav-tabs" role="tablist" style="font-size:13px;">
      <li><a href="#no_content" id="jump1" role="tab" data-toggle="tab">上传资料</a></li>
      <li><a href="#no_content" id="jump2" role="tab" data-toggle="tab">购买资料</a></li>
      <li class="active"><a href="#history_trade" role="tab" data-toggle="tab">历史订单</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active"></div>
      <div class="tab-pane active" id="history_trade">
        <div style="margin-top:30px;">
          <form method="POST" action="{url ebank/tenpaytransfer}" name="trade_form" id="trade_form" class="form-horizontal">
            <table height="100px;" width="100%" border="1px" cellspacing="0" style="text-align:center;">
              <tr style="background-color:#f2f7ff;">
                <th width="60%" style="text-align:center;">订单详情</th>
                <th width="13%" style="text-align:center;">时间</th>
                <th width="12%" style="text-align:center;">状态</th>
                <th width="15%" style="text-align:center;">备注</th>
              </tr>

              <!--{loop $trade_list $trade}-->
              <tr height="69px">
                <td>
                  <!--{loop $trade['trade_info'] $trade_info}-->
                  <div style="padding-top:10px;"><a href="{SITE_URL}?material/view/{$trade_info['mid']}">{$trade_info['title']}</a></div>
                  <!--{/loop}-->
                </td>
                <td>{$trade_info['format_time']}</td>
                <td>
                  <!--{if $trade['status'] == TRADE_STATUS_WAIT_BUYER_PAY}-->
                    等待付款
                  <!--{elseif $trade['status'] == TRADE_STATUS_WAIT_SELLER_SEND_GOODS}-->
                    等待发货
                  <!--{elseif $trade['status'] == TRADE_STATUS_WAIT_BUYER_CONFIRM_GOODS}-->
                    等待确认收货
                  <!--{elseif $trade['status'] == TRADE_STATUS_FINISHED}-->
                    交易成功结束
                  <!--{elseif $trade['status'] == TRADE_STATUS_CLOSED}-->
                    交易未成功完成
                  <!--{else}-->
                    未知状态
                  <!--{/if}-->
                </td>
                <td>
                  <!--{if $trade['status'] == TRADE_STATUS_WAIT_SELLER_SEND_GOODS || 
                          $trade['status'] == TRADE_STATUS_WAIT_BUYER_CONFIRM_GOODS ||
                          $trade['status'] == TRADE_STATUS_FINISHED}-->
                          <button class="btn btn-info btn-sm" type="button" title="获取资料地址" data-toggle="modal" data-target="#material_url" id="{$trade['trade_no']}">获取资料</button>
                  <!--{/if}-->
                </td>
              </tr>
              <!--{/loop}-->
            </table>
            <center><div class="pages" style="margin-top:20px;">{$departstr}</div></center>
          </form>
        </div>

      </div> <!-- END shooping_cart tab -->
    </div> <!-- END tab-content -->
  </div>
</div>

<div class="modal fade" id="material_url" role="dialog">
  <div class="modal-dialog" style="width:750px;">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">获取资料链接</h4>
      </div>
      <div class="modal-body">
        <div id="material_url_list"></div>
      </div>
      <div class="modal-footer"></div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">
$(document).ready(function() {
    $(".prob_demand").click(function() {
    });

    $(".btn-sm").click(function() {
        trade_no = $(this).attr('id');

        $.ajax({
            type: "GET",
            url:"{SITE_URL}?trade/ajaxaccess_material/" + trade_no,
            cache: false,
            success: function(html_text){
                $("#material_url_list").html(html_text);
            }
        });
    });
});

function fetch_trade_info(trade_no) {
    //alert(trade_no);
    /*
    $("#material_url").dialog({
        autoOpen: false,
        width: 500,
        modal: true,
        resizable: false
    });
    $("#material_url").dialog("open");
    */
}

function pay_action(pay_type) {
    if (pay_type == "tenpay_btn") {
        $("#trade_mode").val("1");
        $("#trade_form").attr("action", "{url ebank/tenpaytransfer}");
        $("#trade_form").submit();
    } else if (pay_type == 'alipay_btn') {
        $("#trade_form").attr("action", "{url ebank/alipaytransfer}");
        $("#trade_form").submit();
    }
}

</script>

<!--{template footer}--> 
